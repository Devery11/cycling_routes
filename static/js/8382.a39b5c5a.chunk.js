"use strict";(self.webpackChunkcycling_routes=self.webpackChunkcycling_routes||[]).push([[8382],{80979:(e,t,i)=>{i.d(t,{K:()=>r});const r=["operational-layers","basemap","ground"]},1420:(e,t,i)=>{i.d(t,{g:()=>c});var r=i(35143),a=i(91967),s=i(34154),n=i(46053),o=(i(81806),i(76460),i(47249),i(85842)),l=i(68002),h=i(55053),p=i(46530),d=i(65419);const u={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let c=class extends a.A{constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const t=(0,p.f)(this.floors,e);return e.toExportImageJSON(t)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,d.Sk)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.removeHandles("layer"),e&&this.addHandles([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(u[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){var e;const t=!(null===(e=this.floors)||void 0===e||!e.length),i=this.visibleSublayers.filter((e=>null!=e.definitionExpression||t&&null!=e.floorInfo));return i.length?JSON.stringify(i.reduce(((e,t)=>{const i=(0,p.f)(this.floors,t),r=(0,s.m)(i,t.definitionExpression);return null!=r&&(e[t.id]=r),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,i=this.scale,r=t=>{t.visible&&(0===i||(0,l.zx)(i,t.minScale,t.maxScale))&&(t.sublayers?t.sublayers.forEach(r):e.unshift(t))};t&&t.forEach(r);const a=this._get("visibleSublayers");return!a||a.length!==e.length||a.some(((t,i)=>e[i]!==t))?e:a}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};(0,r._)([(0,n.MZ)({readOnly:!0})],c.prototype,"dynamicLayers",null),(0,r._)([(0,n.MZ)()],c.prototype,"floors",void 0),(0,r._)([(0,n.MZ)({readOnly:!0})],c.prototype,"hasDynamicLayers",null),(0,r._)([(0,n.MZ)()],c.prototype,"layer",null),(0,r._)([(0,n.MZ)({readOnly:!0})],c.prototype,"layers",null),(0,r._)([(0,n.MZ)({readOnly:!0})],c.prototype,"layerDefs",null),(0,r._)([(0,n.MZ)({type:Number})],c.prototype,"scale",void 0),(0,r._)([(0,n.MZ)(h.ui)],c.prototype,"timeExtent",void 0),(0,r._)([(0,n.MZ)({readOnly:!0})],c.prototype,"version",null),(0,r._)([(0,n.MZ)({readOnly:!0})],c.prototype,"visibleSublayers",null),c=(0,r._)([(0,o.$)("esri.layers.mixins.ExportImageParameters")],c)},55053:(e,t,i)=>{i.d(t,{ui:()=>_,Yj:()=>g,id:()=>S,kF:()=>c,fV:()=>m,C1:()=>I,hG:()=>P,hn:()=>M,ke:()=>b,Ih:()=>w,M6:()=>u,Qo:()=>f,Fm:()=>x,PY:()=>d,OZ:()=>y});var r=i(82111),a=i(80979),s=i(76797),n=i(13312),o=i(79453),l=(i(18690),i(53084),i(18288));var h=i(731),p=i(2183);const d={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:{enabled:!0,layerContainerTypes:a.K}}},u={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},c={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:{enabled:!0,layerContainerTypes:a.K}}},y={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:o.w}}},m={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:{enabled:!0,layerContainerTypes:a.K}}},g={value:null,type:h.A,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:{enabled:!0,layerContainerTypes:a.K}}};function f(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const v={write:{enabled:!0,layerContainerTypes:a.K},read:!0},b={type:Number,json:{origins:{"web-document":v,"portal-item":{write:!0}}}},w={...b,json:{...b.json,origins:{"web-document":{...v,write:{enabled:!0,layerContainerTypes:a.K,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>{var r;return i&&"service"!==i.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?null!==(r=t.layerDefinition)&&void 0!==r&&r.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,p.D)(t.layerDefinition.drawingInfo.transparency):void 0:(0,p.D)(t.drawingInfo.transparency)}}}},_={type:r.A,readOnly:!0,get(){var e,t,i;const a=null!=(null===(e=this.layer)||void 0===e?void 0:e.timeInfo)?this.layer:null!=(null===(t=this.i3slayer)||void 0===t?void 0:t.timeInfo)?this.i3slayer:null;if(null==a)return null;const{datesInUnknownTimezone:s,timeOffset:n,useViewTime:o}=a,h=null===(i=this.view)||void 0===i?void 0:i.timeExtent;let p=a.timeExtent;s&&(p=function(e){if(!e)return e;const{start:t,end:i}=e;return new r.A({start:null!=t?(0,l.S1)(t,t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,l.S1)(i,i.getTimezoneOffset(),"minutes"):i})}(p));let d=o?h&&p?h.intersection(p):h||p:p;if(!d||d.isEmpty||d.isAllTime)return d;n&&(d=d.offset(-n.value,n.unit)),s&&(d=function(e){if(!e)return e;const{start:t,end:i}=e;return new r.A({start:null!=t?(0,l.S1)(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=i?(0,l.S1)(i,-i.getTimezoneOffset(),"minutes"):i})}(d));const u=this._get("timeExtent");return d.equals(u)?u:d}},x={type:s.A,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=s.A.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(i.spatialReference=n.A.fromJSON(t.spatialReference)),i}}}},read:!1}},S={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},M={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.minScale",write:{enabled:!0,layerContainerTypes:a.K}}},name:"layerDefinition.minScale",write:!0}},P={type:Number,json:{origins:{service:{write:{enabled:!1}},"web-scene":{name:"layerDefinition.maxScale",write:{enabled:!0,layerContainerTypes:a.K}}},name:"layerDefinition.maxScale",write:!0}},I={json:{write:{ignoreOrigin:!0,layerContainerTypes:a.K},origins:{"web-map":{read:!1,write:!1}}}}},14509:(e,t,i)=>{i.d(t,{l:()=>n});var r=i(69139),a=i(61551),s=i(36201);class n extends s.A{constructor(){super(...arguments),this._hasCrossfade=!1}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(e){super.beforeRender(e),this._manageFade()}prepareRenderPasses(e){const t=e.registerRenderPass({name:"bitmap",brushes:[r.d.bitmap],target:()=>this.children,drawPhase:a.S5.MAP});return[...super.prepareRenderPasses(e),t]}_manageFade(){this.children.reduce(((e,t)=>e+(t.inFadeTransition?1:0)),0)>=2?(this.children.forEach((e=>e.blendFunction="additive")),this._hasCrossfade=!0):(this.children.forEach((e=>e.blendFunction="standard")),this._hasCrossfade=!1)}}},18382:(e,t,i)=>{i.r(t),i.d(t,{default:()=>S});var r=i(35143),a=i(76460),s=i(50346),n=i(68134),o=i(46053),l=(i(81806),i(47249),i(85842)),h=i(64519),p=i(14509),d=i(90104),u=i(45992),c=i(70822),y=i(4176),m=i(91196),g=i(55053),f=i(1420);const v=e=>{let t=class extends e{initialize(){this.exportImageParameters=new f.g({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.floors)&&void 0!==e?e:null}get exportImageVersion(){var e;return null!==(e=this.exportImageParameters)&&void 0!==e&&e.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}canResume(){var e;return!!super.canResume()&&!(null!==(e=this.timeExtent)&&void 0!==e&&e.isEmpty)}};return(0,r._)([(0,o.MZ)()],t.prototype,"exportImageParameters",void 0),(0,r._)([(0,o.MZ)({readOnly:!0})],t.prototype,"floors",null),(0,r._)([(0,o.MZ)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,r._)([(0,o.MZ)()],t.prototype,"layer",void 0),(0,r._)([(0,o.MZ)()],t.prototype,"suspended",void 0),(0,r._)([(0,o.MZ)(g.ui)],t.prototype,"timeExtent",void 0),t=(0,r._)([(0,l.$)("esri.views.layers.MapImageLayerView")],t),t};var b=i(771),w=i(93080),_=i(55754);let x=class extends(v((0,b.A)((0,d.e)(m.A)))){constructor(){super(...arguments),this._highlightGraphics=new h.Y,this._updateHash=""}fetchPopupFeaturesAtLocation(e,t){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(e,t)}update(e){const t="".concat(this.exportImageVersion,"/").concat(e.state.id,"/").concat(e.pixelRatio,"/").concat(e.stationary);this._updateHash!==t&&(this._updateHash=t,this.strategy.update(e).catch((e=>{(0,s.zf)(e)||a.A.getLogger(this).error(e)})),e.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(e.state.resolution)),this._highlightView.processUpdate(e)}attach(){const{imageMaxWidth:e,imageMaxHeight:t,version:i}=this.layer,r=i>=10.3,a=i>=10;this._bitmapContainer=new p.l,this.container.addChild(this._bitmapContainer),this._highlightView=new u.A({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new c.A(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new w.Uh({createFetchPopupFeaturesQueryGeometry:(e,t)=>(0,_.V)(e,t,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(e,t)=>{this._highlightView.graphicUpdateHandler({graphic:e,property:t})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new y.A({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:r,imageNormalizationSupported:a,hidpi:!0}),this.addAttachHandles((0,n.wB)((()=>this.exportImageVersion),(()=>this.requestUpdate()))),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return this.layer.serviceSupportsSpatialReference(e)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,i,r){return this.layer.fetchImage(e,t,i,{timeExtent:this.timeExtent,floors:this.floors,...r})}fetchImageBitmap(e,t,i,r){return this.layer.fetchImageBitmap(e,t,i,{timeExtent:this.timeExtent,floors:this.floors,...r})}highlight(e){return this._popupHighlightHelper.highlight(e)}};(0,r._)([(0,o.MZ)()],x.prototype,"strategy",void 0),(0,r._)([(0,o.MZ)()],x.prototype,"updating",void 0),x=(0,r._)([(0,l.$)("esri.views.2d.layers.MapImageLayerView2D")],x);const S=x},4176:(e,t,i)=>{i.d(t,{A:()=>I});var r=i(35143),a=i(91967),s=(i(81806),i(50346)),n=i(46053),o=(i(76460),i(47249),i(85842)),l=i(2413),h=i(80963),p=i(88235);const d=Math.PI/180;function u(e){return e*d}function c(e,t){const i=u(t.rotation),r=Math.abs(Math.cos(i)),a=Math.abs(Math.sin(i)),[s,n]=t.size;return e[0]=Math.round(n*a+s*r),e[1]=Math.round(n*r+s*a),e}var y=i(16060),m=i(40181),g=i(93453);const f=(0,l.vt)(),v=[0,0],b=new g.A(0,0,0,0),w=2048,_=2048,x=!1,S=!1,M=!1;let P=class extends a.A{constructor(e){super(e),this._imagePromise=null,this.bitmaps=[],this.hidpi=M,this.imageMaxWidth=w,this.imageMaxHeight=_,this.imageRotationSupported=x,this.imageNormalizationSupported=S,this.update=(0,s.sg)((async(e,t)=>{var i,r;if((0,s.Te)(t),!e.stationary||this.destroyed)return;const a=e.state,n=(0,h.Vp)(a.spatialReference),o=this.hidpi?e.pixelRatio:1,l=this.imageNormalizationSupported&&a.worldScreenWidth&&a.worldScreenWidth<a.size[0],p=null!==(i=this.imageMaxWidth)&&void 0!==i?i:0,d=null!==(r=this.imageMaxHeight)&&void 0!==r?r:0;l?(v[0]=a.worldScreenWidth,v[1]=a.size[1]):this.imageRotationSupported?(v[0]=a.size[0],v[1]=a.size[1]):c(v,a);const u=Math.floor(v[0]*o)>p||Math.floor(v[1]*o)>d,y=n&&(a.extent.xmin<n.valid[0]||a.extent.xmax>n.valid[1]),m=!this.imageNormalizationSupported&&y,g=!u&&!m,f=this.imageRotationSupported?a.rotation:0,w=this.container.children.slice();if(g){const e=l?a.paddedViewState.center:a.center;this._imagePromise&&console.error("Image promise was not defined!"),this._imagePromise=this._singleExport(a,v,e,a.resolution,f,o,t)}else{let e=Math.min(p,d);m&&(e=Math.min(a.worldScreenWidth,e)),this._imagePromise=this._tiledExport(a,e,o,t)}try{var _;const e=null!==(_=await this._imagePromise)&&void 0!==_?_:[];(0,s.Te)(t);const i=[];if(this._imagePromise=null,this.destroyed)return;this.bitmaps=e;for(const t of w)e.includes(t)||i.push(t.fadeOut().then((()=>{t.remove(),t.destroy()})));for(const t of e)i.push(t.fadeIn());await Promise.all(i)}catch(b){this._imagePromise=null,(0,s.QP)(b)}}),5e3),this.updateExports=(0,s.sg)((async e=>{const t=[];for(const i of this.container.children){if(!i.visible||!i.stage)return;t.push(e(i).then((()=>{i.invalidateTexture(),i.requestRender()})))}this._imagePromise=(0,s.Lx)(t).then((()=>this._imagePromise=null)),await this._imagePromise}))}destroy(){this.bitmaps.forEach((e=>e.destroy())),this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(e,t,i,r,a,n){const o=await this.fetchSource(e,Math.floor(t*a),Math.floor(i*a),{rotation:r,pixelRatio:a,signal:n});(0,s.Te)(n);const l=new y.mb(null,!0);return l.x=e.xmin,l.y=e.ymax,l.resolution=e.width/t,l.rotation=r,l.pixelRatio=a,l.opacity=0,this.container.addChild(l),await l.setSourceAsync(o,n),(0,s.Te)(n),l}async _singleExport(e,t,i,r,a,s,n){!function(e,t,i,r){const[a,s]=t,[n,o]=r,l=.5*i;e[0]=a-l*n,e[1]=s-l*o,e[2]=a+l*n,e[3]=s+l*o}(f,i,r,t);const o=(0,l.w1)(f,e.spatialReference);return[await this._export(o,t[0],t[1],a,s,n)]}_tiledExport(e,t,i,r){const a=p.A.create({size:t,spatialReference:e.spatialReference,scales:[e.scale]}),s=new m.A(a),n=s.getTileCoverage(e);if(!n)return null;const o=[];return n.forEach(((a,n,h,p)=>{b.set(a,n,h,0),s.getTileBounds(f,b);const d=(0,l.w1)(f,e.spatialReference);o.push(this._export(d,t,t,0,i,r).then((e=>(0!==p&&(b.set(a,n,h,p),s.getTileBounds(f,b),e.x=f[0],e.y=f[3]),e))))})),Promise.all(o)}};(0,r._)([(0,n.MZ)()],P.prototype,"_imagePromise",void 0),(0,r._)([(0,n.MZ)()],P.prototype,"bitmaps",void 0),(0,r._)([(0,n.MZ)()],P.prototype,"container",void 0),(0,r._)([(0,n.MZ)()],P.prototype,"fetchSource",void 0),(0,r._)([(0,n.MZ)()],P.prototype,"hidpi",void 0),(0,r._)([(0,n.MZ)()],P.prototype,"imageMaxWidth",void 0),(0,r._)([(0,n.MZ)()],P.prototype,"imageMaxHeight",void 0),(0,r._)([(0,n.MZ)()],P.prototype,"imageRotationSupported",void 0),(0,r._)([(0,n.MZ)()],P.prototype,"imageNormalizationSupported",void 0),(0,r._)([(0,n.MZ)()],P.prototype,"requestUpdate",void 0),(0,r._)([(0,n.MZ)()],P.prototype,"updating",null),P=(0,r._)([(0,o.$)("esri.views.2d.layers.support.ExportStrategy")],P);const I=P}}]);
//# sourceMappingURL=8382.a39b5c5a.chunk.js.map